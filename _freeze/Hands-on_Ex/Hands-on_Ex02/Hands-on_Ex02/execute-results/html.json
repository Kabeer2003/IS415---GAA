{
  "hash": "9a58ee6764bdd0ea2ba524be1cecef3c",
  "result": {
    "markdown": "---\ntitle: \"Hands-on_Ex02:Thematic Mapping and GeoVisualisation with R\"\nauthor: Kabeer\nDate: \"February 22, 2024\"\nexecute: \n  eval: true\n  echo: true\n  message: false\n  warning: false\n  freeze: true\n\n---\n\n\nLoading relevant packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, tmap, tidyverse)\n```\n:::\n\n\nImporting relevant map data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz <- sf::st_read(dsn = \"D:/Kabeer2003/IS415 - GAA/Hands-on_Ex/Hands-on_Ex01/data/geospatial\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `MP14_SUBZONE_NO_SEA_PL' from data source \n  `D:\\Kabeer2003\\IS415 - GAA\\Hands-on_Ex\\Hands-on_Ex01\\data\\geospatial' \n  using driver `ESRI Shapefile'\nSimple feature collection with 323 features and 15 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33\nProjected CRS: SVY21\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 323 features and 15 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33\nProjected CRS: SVY21\nFirst 10 features:\n   OBJECTID SUBZONE_NO           SUBZONE_N SUBZONE_C CA_IND    PLN_AREA_N\n1         1          2       PEOPLE'S PARK    OTSZ02      Y        OUTRAM\n2         2          2         BUKIT MERAH    BMSZ02      N   BUKIT MERAH\n3         3          3           CHINATOWN    OTSZ03      Y        OUTRAM\n4         4          4             PHILLIP    DTSZ04      Y DOWNTOWN CORE\n5         5          5       RAFFLES PLACE    DTSZ05      Y DOWNTOWN CORE\n6         6          4        CHINA SQUARE    OTSZ04      Y        OUTRAM\n7         7         10         TIONG BAHRU    BMSZ10      N   BUKIT MERAH\n8         8         12    BAYFRONT SUBZONE    DTSZ12      Y DOWNTOWN CORE\n9         9          4 TIONG BAHRU STATION    BMSZ04      N   BUKIT MERAH\n10       10          6       CLIFFORD PIER    DTSZ06      Y DOWNTOWN CORE\n   PLN_AREA_C       REGION_N REGION_C          INC_CRC FMEL_UPD_D   X_ADDR\n1          OT CENTRAL REGION       CR B4120D23006C932A 2016-05-11 28831.78\n2          BM CENTRAL REGION       CR 1C51019439A68700 2016-05-11 26360.80\n3          OT CENTRAL REGION       CR 0FF1661344C84AED 2016-05-11 29153.97\n4          DT CENTRAL REGION       CR 615D4EDDEF809F8E 2016-05-11 29706.72\n5          DT CENTRAL REGION       CR 72107B11807074F4 2016-05-11 29968.62\n6          OT CENTRAL REGION       CR B609DF5587626C8F 2016-05-11 29509.64\n7          BM CENTRAL REGION       CR A0FB4B68155D164A 2016-05-11 27785.67\n8          DT CENTRAL REGION       CR 197F5E664DA4D5E1 2016-05-11 30806.24\n9          BM CENTRAL REGION       CR 91FFE927ABE3E4DB 2016-05-11 27277.47\n10         DT CENTRAL REGION       CR 945CC212CA80626F 2016-05-11 30379.50\n     Y_ADDR SHAPE_Leng SHAPE_Area                       geometry\n1  29419.65  1822.1927   93140.44 MULTIPOLYGON (((29099.02 29...\n2  29384.14  3074.9632  411722.82 MULTIPOLYGON (((26750.09 29...\n3  29158.04  4297.5999  587222.68 MULTIPOLYGON (((29161.2 297...\n4  29744.91   871.5549   39437.94 MULTIPOLYGON (((29814.11 29...\n5  29572.76  1872.7522  188767.49 MULTIPOLYGON (((30137.77 29...\n6  29646.45  1605.2797  133006.94 MULTIPOLYGON (((29699.44 29...\n7  29590.40  3303.2149  448127.58 MULTIPOLYGON (((27748.04 29...\n8  29530.17  2897.1264  521200.52 MULTIPOLYGON (((30844.87 29...\n9  29607.02  2506.6879  350787.56 MULTIPOLYGON (((27444.04 29...\n10 29776.43  2405.9909  261843.90 MULTIPOLYGON (((30436.73 29...\n```\n:::\n:::\n\n\nReading Census Data (2020)\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopdata <- read_csv(\"D:/Kabeer2003/IS415 - GAA/Hands-on_Ex/Hands-on_Ex02/data/aspatial/respopagesextod2011to2020.csv\")\n```\n:::\n\n\nPerforming data transformation on census data\n\n::: {.cell}\n\n```{.r .cell-code}\nfinal_result <- popdata %>%\n  filter(across(any_of(c(\"Time\")), ~. == 2020)) %>%\n  group_by(PA, SZ, AG) %>%\n  summarise(POP = sum(Pop)) %>%\n  ungroup() %>%\n  pivot_wider(names_from = AG, values_from = POP) %>%\n  mutate(YOUNG = rowSums(.[3:6]) + rowSums(.[12]),\n         `ECONOMY ACTIVE` = rowSums(.[7:11]) + rowSums(.[13:15]),\n         `AGED` = rowSums(.[16:21]),\n         `TOTAL` = rowSums(.[3:21]),\n         `DEPENDENCY` = (`YOUNG` + `AGED`) / `ECONOMY ACTIVE`) %>%\n  select(PA, SZ, YOUNG, `ECONOMY ACTIVE`, AGED, TOTAL, DEPENDENCY)\n```\n:::\n\n\nJoining attribute data with Geospatial data\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopdata2020 <- final_result %>%\n  mutate_at(.vars = vars(PA, SZ), \n          .funs = list(toupper)) %>%\n  filter(`ECONOMY ACTIVE` > 0)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz_pop2020 <- left_join(mpsz, popdata2020,\n                          by = c(\"SUBZONE_N\" = \"SZ\"))\n```\n:::\n\n\nLeft join map with aspatial data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Specify the directory path\ndirectory_path <- \"D:/Kabeer2003/IS415 - GAA/Hands-on_Ex/Hands-on_Ex02/data/rds/\"\n\nif (!dir.exists(directory_path)) {\n  dir.create(directory_path, recursive = TRUE)\n}\n\nwrite_rds(mpsz_pop2020, file.path(directory_path, \"mpszpop2020.rds\"))\n```\n:::\n\n\nPlotting a choropleth map (Quick) using tmap\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\nqtm(mpsz_pop2020, \n    fill = \"DEPENDENCY\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex02_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nPlotting a detailed choropleth map using tmap elements \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020)+\n  tm_fill(\"DEPENDENCY\", \n          style = \"quantile\", \n          palette = \"Blues\",\n          title = \"Dependency ratio\") +\n  tm_layout(main.title = \"Distribution of Dependency Ratio by planning subzone\",\n            main.title.position = \"center\",\n            main.title.size = 1.2,\n            legend.height = 0.5, \n            legend.width = 0.4,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", size = 2) +\n  tm_scale_bar() +\n  tm_grid(alpha =0.2) +\n  tm_credits(\"Source: Planning Sub-zone boundary from Urban Redevelopment Authorithy (URA)\\n and Population data from Department of Statistics DOS\", \n             position = c(\"left\", \"bottom\"))\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex02_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nDrawing a map (Practice)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_polygons(\"DEPENDENCY\", n = 5, style = \"equal\") + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex02_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nFinding statistical summary (Quartiles) to accurately plot map\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mpsz_pop2020$DEPENDENCY)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n 0.1111  0.7147  0.7866  0.8585  0.8763 19.0000      92 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020)+\n  tm_fill(\"DEPENDENCY\",n = 6,style = \"quantile\", palette = \"-Blues\") +\n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex02_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020)+\n  tm_fill(\"DEPENDENCY\", \n          style = \"quantile\", \n          palette = \"Blues\",\n          title = \"No. of persons\") +\n  tm_layout(main.title = \"Distribution of Dependency Ratio \\nby planning subzone\",\n            main.title.position = \"center\",\n            main.title.size = 1.2,\n            legend.height = 0.45, \n            legend.width = 0.35,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"4star\", size = 2) +\n  tm_scale_bar(width = 0.15) +\n  tm_grid(lwd = 0.1, alpha = 0.2) +\n  tm_credits(\"Source: Planning Sub-zone boundary from Urban Redevelopment Authorithy (URA)\\n and Population data from Department of Statistics DOS\", \n             position = c(\"left\", \"bottom\"))\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex02_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nPlotting individual choropleth maps for five regions of Singapore depicting the dependency ratio in each neighbourhood.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          style = \"quantile\",\n          palette = \"Blues\",\n          thres.poly = 0) + \n  tm_facets(by=\"REGION_N\", \n            free.coords=TRUE, \n            drop.shapes=TRUE) +\n  tm_layout(legend.show = FALSE,\n            title.position = c(\"center\", \"center\"), \n            title.size = 20) +\n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex02_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Hands-on_Ex02_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}