---
title: "Take-home_Ex01"
---

Installing relevant R packages

```{r}
pacman::p_load(arrow, classInt, lubridate, maptools, raster, sf, spatstat, sp, spNetwork, tidyverse, tmap, viridis)
```

Importing Aspatial Data (GrabPosisi)

```{r}
grabdata <- read_parquet("D:/Kabeer2003/IS415 - GAA/Take-Home_Ex/Take-Home_Ex01/data/aspatial/GrabPosisi/part-00000.parquet")
```

Importing Spatial Data 

```{r}
map_sf <- st_read("D:/Kabeer2003/IS415 - GAA/Take-Home_Ex/Take-Home_Ex01/data/geospatial/MasterPlan2019SubzoneBoundaryNoSeaGEOJSON.geojson")
```
```{r}
roads_sf <- st_read("D:/Kabeer2003/IS415 - GAA/Take-Home_Ex/Take-Home_Ex01/data/geospatial/singapore_roads.gpkg")

roads_sf <- roads_sf %>% filter(fclass %in% c("primary", "secondary", "tertiary", "motorway", "trunk"), !is.na(name))


```

Finding points of origin for each trip by setting the index to 1

```{r}
trips_by_origin_pts <- grabdata %>%
  group_by(trj_id) %>%
  slice(1) %>%
  filter(speed <= 1 && speed >= -1) %>%  
  select(trj_id, latitude = rawlat, longitude = rawlng, speed)
```

Similarly, finding points of destination for each trip by setting the index to (n)

```{r}
trips_by_destination_pts <- grabdata %>%
  group_by(trj_id) %>%
  slice(n()) %>%
  filter(speed <= 1 && speed >= -1) %>%  
  select(trj_id, latitude = rawlat, longitude = rawlng, speed)

```

Binding origin and destination points together for each trip

```{r}
specific_trips_sf <- grabdata %>%
  filter(trj_id == 10038)

specific_trips_sf <- st_as_sf(specific_trips_sf, coords = c("rawlng", "rawlat"), crs = 4326)


```

Plotting the map

```{r}

map_sf <- st_make_valid(map_sf)
roads_sf <- st_make_valid(roads_sf)
#trips_by_destination_pts <- st_make_valid(trips_by_destination_pts)
trips_by_destination_pts <- st_as_sf(trips_by_destination_pts, coords = c("longitude", "latitude"), crs = 4326)

tmap_mode('view')
tm_shape(map_sf) +
  tm_borders() +
  tm_shape(roads_sf) +
  tm_lines() +
  tm_shape(trips_by_destination_pts) +
  tm_dots()


```


Planned approach

Transform aspatial data (Follow In-class Exercise 2)

Plot on map using NKDE (Owin objects thingy) (Follow In-class Exercise 3)


